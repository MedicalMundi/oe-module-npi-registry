{% extends 'base-layout-tbs-5.html.twig' %}

{% block main %}
    <div id="output" class="container"></div>

    <div class="row col-11  my-5">
         {{ include('_form.html.twig') }}
    </div>
    <div class="row col-11  my-5 p-1">
        <div class="card">
            <div class="table-responsive">
                <table class=" table table-striped table-hover">
                    <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Number</th>
                        <th scope="col">NPI Type</th>
                        <th scope="col">Name</th>

                        <th scope="col">Primary Practice Address</th>

                        <th scope="col">Phone</th>

                        <th scope="col">Primary Taxonomy</th>
                    </tr>
                    </thead>
                    <tbody>
                    {{ items.result_count }}

                    {% for item in items.results %}
                        <tr>
                            <td>#</td>
                            <td>{{ item.number }}</td>
                            <td>{{ item.enumeration_type }}</td>
                            <td>
                                {% if item.enumeration_type == 'NPI-1'%}
                                    {{ item.basic.first_name }} {{ item.basic.last_name }}
                                {% else %}
                                    {{ item.basic.organization_name }}
                                {% endif %}
                            </td>
                            <td>
                                {{ item.addresses[0].address_1 }} <br>
                                {{ item.addresses[0].city }} {{ item.addresses[0].state }} {{ item.addresses[0].postal_code }}
                            </td>
                            <td>{{ item.addresses[0].telephone_number }}</td>
                            <td>{{ item.taxonomies[0].desc }}</td>
                        </tr>
                    {% endfor %}

                    </tbody>
                </table>
            </div>
        </div>

    </div>
{% endblock %}



{% block module_javascripts %}
{{ parent() }}

    <script>
        (function () {
            var output = document.getElementById('output');
            document.getElementById('sendSearchForm').onclick = function () {
                var npiNumber = document.getElementById('npiNumber').value;
                var npiType = document.getElementById('npiType').value;
                var npiTaxonomyDescription = document.getElementById('npiTaxonomyDescription').value;

                var providerFirstName = document.getElementById('providerFirstName').value;
                var providerLastName = document.getElementById('providerLastName').value;

                var organizationName = document.getElementById('organizationName').value;
                var aoFirstName = document.getElementById('aoFirstName').value;
                var aoLastName = document.getElementById('aoLastName').value;

                var city = document.getElementById('city').value;
                var state = document.getElementById('state').value;
                var country = document.getElementById('country').value;
                var postalCode = document.getElementById('postalCode').value;
                var addressType = document.getElementById('addressType').value;

                axios.post('/api/search', {
                    // BASE
                    'npiNumber': npiNumber,
                    'npiType': npiType,
                    'npiTaxonomyDescription': npiTaxonomyDescription,
                    // INDIVIDUAL
                    'providerFirstName': providerFirstName,
                    'providerLastName': providerLastName,
                    // ORGANIZATION
                    'organizationName': organizationName,
                    'aoFirstName': aoFirstName,
                    'aoLastName': aoLastName,
                    // LOCATION
                    'city': city,
                    'state': state,
                    'country': country,
                    'postalCode': postalCode,
                    'addressType': addressType,
                    }, {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                    }
                )
                    .then(function (res) {
                        output.className = 'container';
                        output.innerHTML = res.data;
                        console.log(res.data)
                    })
                    .catch(function (err) {
                        output.className = 'container text-danger';
                        output.innerHTML = err.message;
                    });
            };
        })();
    </script>

{% endblock %}



